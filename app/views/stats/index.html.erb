<% content_for :title, t('stats.title', default: 'Stats') %>

<div class="stats-container" data-controller="stats">
  <div class="page-header">
    <h1><%= t('stats.title', default: 'Stats') %></h1>
  </div>

  <div class="card">
    <div class="hint text-sm text-gray-600 mb-3">
      <%= t('stats.threshold_hint', default: 'Tables only display rows with enough data: at least %{players} unique players and %{games} games. Non-competitive games are excluded. ', players: Rails.application.config.x.stats.min_players, games: Rails.application.config.x.stats.min_games) %>
    </div>
    <label for="system-select"><%= t('stats.system_label', default: 'Game system') %></label>
    <select id="system-select" class="input" data-stats-target="system" data-action="change->stats#onSystemChange">
      <option value=""><%= t('stats.select_system', default: 'Select a game system') %></option>
      <% @systems.sort_by(&:localized_name).each do |sys| %>
        <option value="<%= sys.id %>"><%= sys.localized_name %></option>
      <% end %>
    </select>

    <div id="factions-table" class="mt-3" hidden>
      <div class="hint text-sm text-gray-500">
        <%= t('stats.mirror_hint', default: 'Mirror games are counted in total but excluded from W/L/D and Win%.') %>
      </div>
      <table class="table" data-stats-target="factionsTable">
        <thead>
          <tr>
            <th class="sortable" data-action="click->stats#sort" data-key="faction_name"><%= t('stats.faction', default: 'Faction') %></th>
            <th class="sortable" data-action="click->stats#sort" data-key="total_games"><%= t('stats.total_games', default: 'Games') %></th>
            <th class="sortable" data-action="click->stats#sort" data-key="unique_players"><%= t('stats.unique_players', default: 'Players') %></th>
            <th class="sortable" data-action="click->stats#sort" data-key="wins"><%= t('stats.wins', default: 'Wins') %></th>
            <th class="sortable" data-action="click->stats#sort" data-key="losses"><%= t('stats.losses', default: 'Losses') %></th>
            <th class="sortable" data-action="click->stats#sort" data-key="draws"><%= t('stats.draws', default: 'Draws') %></th>
            <th class="sortable" data-action="click->stats#sort" data-key="win_percent"><%= t('stats.win_percent', default: 'Win%') %></th>
            <th class="sortable" data-action="click->stats#sort" data-key="loss_percent"><%= t('stats.loss_percent', default: 'Loss%') %></th>
            <th class="sortable" data-action="click->stats#sort" data-key="draw_percent"><%= t('stats.draw_percent', default: 'Draw%') %></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card mt-6">
    <label for="faction-select"><%= t('stats.faction_label', default: 'Faction') %></label>
    <div class="hint text-sm text-gray-600 mb-3">
      <%= t('stats.threshold_hint', default: 'Tables only display rows with enough data: at least %{players} unique players and %{games} games. Non-competitive games are excluded. ', players: Rails.application.config.x.stats.min_matchup_players, games: Rails.application.config.x.stats.min_matchup_games) %>
    </div>
    <select id="faction-select" class="input" data-stats-target="faction" data-action="change->stats#onFactionChange" disabled>
      <option value=""><%= t('stats.select_faction', default: 'Select a faction') %></option>
    </select>

    <div class="card-body">
      <div id="faction-graph" class="mt-2 chart-wrapper" hidden data-stats-target="chart" data-controller="elo-chart" data-elo-chart-series-value="[]">
        <svg data-elo-chart-target="chart" viewBox="0 0 800 300" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;"></svg>
      </div>
    </div>

    <div id="versus-table" class="mt-4" hidden>
      <table class="table" data-stats-target="versusTable">
        <thead>
          <tr>
            <th class="sortable" data-action="click->stats#sortVs" data-key="opponent_faction_name"><%= t('stats.opponent', default: 'Opponent') %></th>
            <th class="sortable" data-action="click->stats#sortVs" data-key="games"><%= t('stats.games', default: 'Games') %></th>
            <th class="sortable" data-action="click->stats#sortVs" data-key="unique_players"><%= t('stats.unique_players', default: 'Players') %></th>
            <th class="sortable" data-action="click->stats#sortVs" data-key="wins"><%= t('stats.wins', default: 'Wins') %></th>
            <th class="sortable" data-action="click->stats#sortVs" data-key="losses"><%= t('stats.losses', default: 'Losses') %></th>
            <th class="sortable" data-action="click->stats#sortVs" data-key="draws"><%= t('stats.draws', default: 'Draws') %></th>
            <th class="sortable" data-action="click->stats#sortVs" data-key="win_percent"><%= t('stats.win_percent', default: 'Win%') %></th>
            <th class="sortable" data-action="click->stats#sortVs" data-key="loss_percent"><%= t('stats.loss_percent', default: 'Loss%') %></th>
            <th class="sortable" data-action="click->stats#sortVs" data-key="draw_percent"><%= t('stats.draw_percent', default: 'Draw%') %></th>
            <th><%= t('stats.mirrors', default: 'Mirrors') %></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>


