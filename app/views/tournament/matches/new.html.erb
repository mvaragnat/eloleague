<%= turbo_frame_tag "modal" do %>
	<div class="modal-overlay" data-controller="modal">
		<div class="modal-card" style="max-height:90vh; overflow-y:auto; width:90vw; max-width:800px;">
			<h2><%= t('tournaments.show.matches', default: 'Matches') %> â€” <%= @tournament.name %></h2>

			<%= form_with(model: @game, url: tournament_tournament_matches_path(@tournament), scope: :game_event, data: { controller: "game-form", action: "submit->game-form#validate player-selected->game-form#onPlayerSelected player-removed->game-form#onPlayerRemoved", game_form_factions_url_value: game_factions_path(locale: I18n.locale), game_form_two_players_value: true }) do |form| %>
				<div data-game-form-target="error" class="hidden" style="color:#dc2626;font-size:0.875rem;"></div>

				<!-- Hidden system select to trigger faction loading -->
				<select name="game_event[game_system_id]" style="display:none;">
					<option value="<%= @tournament.game_system_id %>" selected="selected"></option>
				</select>

				<%= render partial: 'shared/participations_fields',
						 locals: { form: form,
									 preselected_user: @preselected_user,
									 preselected_removable: @preselected_removable,
									 tournament_id: @tournament.id,
									 initial_factions: Game::Faction.where(game_system_id: @tournament.game_system_id).to_a } %>

				<div style="display:flex;justify-content:flex-end;gap:0.75rem;margin-top:1rem;">
					<%= link_to t('layouts.shared.cancel'), "#", data: { action: "click->modal#close" }, class: "btn" %>
					<%= form.submit t('games.new.submit'), class: "btn btn-primary" %>
				</div>
			<% end %>
		</div>
	</div>
<% end %> 