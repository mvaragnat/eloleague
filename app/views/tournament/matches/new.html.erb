<%= turbo_frame_tag "modal" do %>
	<div class="modal-overlay" data-controller="modal">
		<div class="modal-card">
			<h2><%= t('tournaments.show.matches', default: 'Matches') %> â€” <%= @tournament.name %></h2>

			<%= form_with(model: @game, url: tournament_tournament_matches_path(@tournament), scope: :game_event, data: { controller: "game-form", action: "submit->game-form#validate player-selected->game-form#showScores player-removed->game-form#toggleScores" }) do |form| %>
				<div data-game-form-target="error" class="hidden" style="color:#dc2626;font-size:0.875rem;"></div>

				<!-- Opponent selector -->
				<div data-controller="player-search" data-player-search-target="container">
					<label><%= t('games.new.participants') %></label>
					<div>
						<input type="text"
								 data-player-search-target="input"
								 data-action="input->player-search#search"
								 data-tournament-id="<%= @tournament.id %>"
								 placeholder="<%= t('games.new.search_placeholder') %>">
					</div>
					<div data-player-search-target="results" class="card" style="padding:0.25rem; margin-top:0.25rem; max-height: 220px; overflow:auto;"></div>
					<div data-player-search-target="selected" style="margin-top: 0.5rem;"></div>
				</div>

				<div data-game-form-target="scores" class="hidden" style="margin-top: 1rem; display:grid; gap:0.75rem;">
					<%= form.fields_for :game_participations do |p_form| %>
						<div>
							<%= p_form.label :score, t('games.new.your_score') %>
							<%= p_form.number_field :score, min: 0 %>
							<%= p_form.label :secondary_score, t('games.new.secondary_score', default: 'Secondary score'), style: 'display:block; margin-top:0.25rem;' %>
							<%= p_form.number_field :secondary_score, min: 0 %>
							<%= p_form.hidden_field :user_id %>
						</div>
						<div>
							<%= p_form.label :faction_id, t('games.new.your_faction', default: 'Your faction') %>
							<%= p_form.select :faction_id, [], { prompt: t('games.new.select_faction', default: 'Select faction') } %>
						</div>
					<% end %>

					<div>
						<label><%= t('games.new.opponent_score') %></label>
						<input type="number" min="0" name="game_event[game_participations_attributes][1][score]" />
						<label style="display:block; margin-top:0.25rem;"><%= t('games.new.opponent_secondary_score', default: 'Opponent secondary score') %></label>
						<input type="number" min="0" name="game_event[game_participations_attributes][1][secondary_score]" />
					</div>
					<div>
						<label><%= t('games.new.opponent_faction', default: 'Opponent faction') %></label>
						<select name="game_event[game_participations_attributes][1][faction_id]"></select>
					</div>
				</div>

				<div style="display:flex;justify-content:flex-end;gap:0.75rem;margin-top:1rem;">
					<%= link_to t('layouts.shared.cancel'), "#", data: { action: "click->modal#close" }, class: "btn" %>
					<%= form.submit t('games.new.submit'), class: "btn btn-primary" %>
				</div>
			<% end %>
		</div>
	</div>
<% end %> 