<% outcome_class = case @event.winner_user&.id
when nil then 'card--draw'
when @current_user.id then 'card--win'
else 'card--loss'
end %>
<% my_change = EloChange.find_by(game_event: @event, user: @current_user) %>
<% opp_change = EloChange.find_by(game_event: @event, user: opponent_participation&.user) %>
<div class="card <%= outcome_class %>">
  <div class="card-header">
    <h3><%= t('games.game_of') %> <%= @event.game_system.localized_name %></h3>
    <p class="card-date"><%= l(@event.played_at, format: :card) %></p>
  </div>

  <div class="card-body">
    <% my = @participation %>
    <% opp = opponent_participation %>
    <div class="card-row">
      <div class="player">
        <%= @current_user.username %>
        <% if my_change %>
          <div class="card-date">(<%= my_change.rating_before %> → <%= my_change.rating_after %>)</div>
        <% end %>
      </div>
      <div class="score">
        <%= [my&.score, opp&.score].compact.join(' - ') %>
        <% if my&.secondary_score.present? || opp&.secondary_score.present? %>
          <div class="card-date" style="text-align:center;">
            <%= t('games.secondary_score_short', default: 'TB') %>: <%= my&.secondary_score || 0 %> - <%= opp&.secondary_score || 0 %>
          </div>
        <% end %>
      </div>
      <div class="player" style="text-align: right;">
        <%= opp&.user&.username %>
        <% if opp_change %>
          <div class="card-date">(<%= opp_change.rating_before %> → <%= opp_change.rating_after %>)</div>
        <% end %>
      </div>
    </div>
    <%# Army list view button for my participation if provided %>
    <% if my&.army_list.present? %>
      <div style="margin-top:0.5rem; text-align:center;">
        <%= link_to t('games.view_army_list', default: 'View my army list'), game_event_path(@event), class: 'btn', data: { turbo_frame: 'modal' } %>
      </div>
    <% end %>
  </div>
</div> 